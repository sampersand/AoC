#!/usr/bin/env ruby
require 'optparse'
require 'fileutils'
require 'pathname'

OPTS = {
  year: nil,
  day: nil,
  ext: 'rb'
}

OptParse.new do |op|
  # no month, it's always december
  op.on '-y', '--year=YEAR', Integer, (2015..)
  op.on '-d', '--day=DAY', Integer, 1..25
  op.on '-e', '--ext=EXTENSION', 'Set extension [default to .rb]'
  op.on '-n', '--now', 'Set current day' do
    OPTS[:year] = Time.now.year
    OPTS[:day] = Time.now.day
  end

  op.on '-t', '--tomorrow', 'Set for tomorrow' do
    OPTS[:year] = Time.now.year
    OPTS[:day] = Time.now.day + 1
  end

  op.parse! into: OPTS rescue op.abort

  op.abort "no args allowed" unless $*.empty?
  op.abort "day and year must be specified" unless OPTS[:year] && OPTS[:day]
end

include FileUtils

base = Pathname(__dir__).parent.join(OPTS[:year].to_s, day="day%02d" % OPTS[:day])

mkdir_p base
touch exe = base.join("#{day}.#{OPTS[:ext]}")
chmod '+x', exe
touch base.join('input.txt')
touch base.join('sample.txt')
