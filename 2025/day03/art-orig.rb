$* << 'input.txt' if $*.empty?


  (p1=0;def M(c,r)r!=0?(m=c[
  ##########################
..                          -r
##                          ##
].  max)  +M(c[ c.index(m)+1..],r-1):""end)if$q=->{_2.index _1}
##  ####  ####  ####  ####  ###
##  ####  ####  ####  ####  #####
##  ####  ####  ####  ####  #####
##  ####  ####  ####  ####  ###
##                          ##
  ##########################


p2=$<.sum{p1+=M(q=it[..-2].chars,2).to_i;M(q,12).to_i}
p [p1, p2]

fail unless p1 == 16946
fail unless p2 == 168627047606506
__END__
